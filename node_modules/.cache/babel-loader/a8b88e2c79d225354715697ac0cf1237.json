{"ast":null,"code":"import _toConsumableArray from\"/Applications/MAMP/htdocs/Marvel/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _classCallCheck from\"/Applications/MAMP/htdocs/Marvel/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Applications/MAMP/htdocs/Marvel/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/Applications/MAMP/htdocs/Marvel/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Applications/MAMP/htdocs/Marvel/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React from'react';import{Component}from'react';import Spinner from'../spinner/Spinner';import ErrorMessage from'../errorMessage/ErrorMessage';import MarvelService from'../../services/MarvelService';import'./charList.scss';import CharInfo from'../charInfo/CharInfo';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var CharList=/*#__PURE__*/function(_Component){_inherits(CharList,_Component);var _super=_createSuper(CharList);function CharList(){var _this;_classCallCheck(this,CharList);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={charList:[],loading:true,error:false,newItemLoading:false,offset:210,charEnded:false};_this.marvelService=new MarvelService();_this.onRequest=function(offset){_this.onCharListLoading();_this.marvelService.getAllCharacters(offset).then(_this.onCharListLoaded).catch(_this.onError);};_this.onCharListLoading=function(){_this.setState({newItemLoading:true});};_this.onCharListLoaded=function(newCharList){var ended=false;if(newCharList.length<9){ended=true;}_this.setState(function(_ref){var offset=_ref.offset,charList=_ref.charList;return{charList:[].concat(_toConsumableArray(charList),_toConsumableArray(newCharList)),loading:false,newItemLoading:false,offset:offset+9,charEnded:ended};});};_this.onError=function(){_this.setState({error:true,loading:false});};_this.itemRefs=[];_this.setRef=function(ref){_this.itemRefs.push(ref);};_this.focusOnItem=function(id){_this.itemRefs.forEach(function(item){return item.classList.remove('char__item_selected');});_this.itemRefs[id].classList.add('char__item_selected');_this.itemRefs[id].focus();};return _this;}_createClass(CharList,[{key:\"componentDidMount\",value:function componentDidMount(){this.onRequest();}},{key:\"renderItems\",value:function renderItems(arr){var _this2=this;var items=arr.map(function(item,i){var imgStyle={'objectFit':'cover'};if(item.thumbnail==='http://i.annihil.us/u/prod/marvel/i/mg/b/40/image_not_available.jpg'){imgStyle={'objectFit':'unset'};}return/*#__PURE__*/_jsxs(\"li\",{className:\"char__item\",tabIndex:0,ref:_this2.setRef,onClick:function onClick(){_this2.props.onCharSelected(item.id);_this2.focusOnItem(i);},onKeyPress:function onKeyPress(e){if(e.key===' '||e.key===\"Enter\"){_this2.props.onCharSelected(item.id);_this2.focusOnItem(i);}},children:[/*#__PURE__*/_jsx(\"img\",{src:item.thumbnail,alt:item.name,style:imgStyle}),/*#__PURE__*/_jsx(\"div\",{className:\"char__name\",children:item.name})]},item.id);});return/*#__PURE__*/_jsx(\"ul\",{className:\"char__grid\",children:items});}},{key:\"render\",value:function render(){var _this3=this;var _this$state=this.state,charList=_this$state.charList,loading=_this$state.loading,error=_this$state.error,offset=_this$state.offset,newItemLoading=_this$state.newItemLoading,charEnded=_this$state.charEnded;var items=this.renderItems(charList);var errorMessage=error?/*#__PURE__*/_jsx(ErrorMessage,{}):null;var spinner=loading?/*#__PURE__*/_jsx(Spinner,{}):null;var content=!(loading||error)?items:null;return/*#__PURE__*/_jsxs(\"div\",{className:\"char__list\",children:[errorMessage,spinner,content,/*#__PURE__*/_jsx(\"button\",{className:\"button button__main button__long\",disabled:newItemLoading,style:{'display':charEnded?'none':'block'},onClick:function onClick(){return _this3.onRequest(offset);},children:/*#__PURE__*/_jsx(\"div\",{className:\"inner\",children:\"load more\"})})]});}}]);return CharList;}(Component);export default CharList;","map":{"version":3,"sources":["/Applications/MAMP/htdocs/Marvel/src/components/charList/CharList.js"],"names":["React","Component","Spinner","ErrorMessage","MarvelService","CharInfo","CharList","state","charList","loading","error","newItemLoading","offset","charEnded","marvelService","onRequest","onCharListLoading","getAllCharacters","then","onCharListLoaded","catch","onError","setState","newCharList","ended","length","itemRefs","setRef","ref","push","focusOnItem","id","forEach","item","classList","remove","add","focus","arr","items","map","i","imgStyle","thumbnail","props","onCharSelected","e","key","name","renderItems","errorMessage","spinner","content"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport Spinner from '../spinner/Spinner';\nimport ErrorMessage from '../errorMessage/ErrorMessage';\nimport MarvelService from '../../services/MarvelService';\nimport './charList.scss';\nimport CharInfo from '../charInfo/CharInfo';\n\nclass CharList extends Component {\n\n    state = {\n        charList: [],\n        loading: true,\n        error: false,\n        newItemLoading: false,\n        offset: 210,\n        charEnded: false,\n    }\n    \n    marvelService = new MarvelService();\n\n    componentDidMount() {\n        this.onRequest();\n    }\n\n    onRequest = (offset) => {\n        this.onCharListLoading();\n        this.marvelService.getAllCharacters(offset)\n            .then(this.onCharListLoaded)\n            .catch(this.onError)\n    }\n\n    onCharListLoading = () => {\n        this.setState({\n            newItemLoading: true\n        })\n    }\n\n    onCharListLoaded = (newCharList) => {\n        let ended = false;\n        if (newCharList.length < 9) {\n            ended = true;\n        }\n\n        this.setState(({offset, charList}) => ({\n            charList: [...charList, ...newCharList],\n            loading: false,\n            newItemLoading: false,\n            offset: offset + 9,\n            charEnded: ended\n        }))\n    }\n\n    onError = () => {\n        this.setState({\n            error: true,\n            loading: false\n        })\n    }\n\n    itemRefs = [];\n\n    setRef = (ref) => {\n        this.itemRefs.push(ref);\n    }\n\n    focusOnItem = (id) => {\n        this.itemRefs.forEach(item => item.classList.remove('char__item_selected'));\n        this.itemRefs[id].classList.add('char__item_selected');\n        this.itemRefs[id].focus();\n    }\n\n    renderItems(arr) {\n        const items =  arr.map((item, i) => {\n            let imgStyle = {'objectFit' : 'cover'};\n            if (item.thumbnail === 'http://i.annihil.us/u/prod/marvel/i/mg/b/40/image_not_available.jpg') {\n                imgStyle = {'objectFit' : 'unset'};\n            }\n            \n            return (\n                <li \n                    className=\"char__item\"\n                    tabIndex={0}\n                    ref={this.setRef}\n                    key={item.id}\n                    onClick={() => {\n                        this.props.onCharSelected(item.id);\n                        this.focusOnItem(i);\n                    }}\n                    onKeyPress={(e) => {\n                        if (e.key === ' ' || e.key === \"Enter\") {\n                            this.props.onCharSelected(item.id);\n                            this.focusOnItem(i);\n                        }\n                    }}>\n                        <img src={item.thumbnail} alt={item.name} style={imgStyle}/>\n                        <div className=\"char__name\">{item.name}</div>\n                </li>\n            )\n        });\n        \n        return (\n            <ul className=\"char__grid\">\n                {items}\n            </ul>\n        )\n    }\n\n    render() {\n\n        const {charList, loading, error, offset, newItemLoading, charEnded} = this.state;\n        \n        const items = this.renderItems(charList);\n\n        const errorMessage = error ? <ErrorMessage/> : null;\n        const spinner = loading ? <Spinner/> : null;\n        const content = !(loading || error) ? items : null;\n\n        return (\n            <div className=\"char__list\">\n                {errorMessage}\n                {spinner}\n                {content}\n                <button \n                    className=\"button button__main button__long\"\n                    disabled={newItemLoading}\n                    style={{'display': charEnded ? 'none' : 'block'}}\n                    onClick={() => this.onRequest(offset)}>\n                    <div className=\"inner\">load more</div>\n                </button>\n            </div>\n        )\n    }\n}\n\nCharList.propTypes = {\n    onCharSelected: PropTypes.func.isRequired\n}\n\nexport default CharList;"]},"metadata":{},"sourceType":"module"}